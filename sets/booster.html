<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hoenn Tcg store</title>
    <link rel="stylesheet" href="../estilo.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

</head>
<body>
    
<header class="main-header">
  <div class="logopoki">
    <img src="https://upload.wikimedia.org/wikipedia/commons/9/98/International_Pokémon_logo.svg" alt="Pokémon Logo">
  </div>

  <nav class="main-nav">
    <ul>
      <li><a href="#"><i class="fas fa-fire"></i> Booster</a></li>
      <li><a href="#"><i class="fas fa-box-open"></i> ETBs</a></li>
      <li><a href="#"><i class="fas fa-star"></i> New Arrivals</a></li>
      <li><a href="#"><i class="fas fa-layer-group"></i> Collections</a></li>
      <li><a href="#"><i class="fas fa-globe"></i> Expansions</a></li>
    </ul>
  </nav>

  <h2>Mi Carrito</h2>
      <div id="cart-container" class="cart-container"></div>


  <button id="btn-login" class="btn-login">Sign In</button>
</header>




<!-- Modal oculto -->
<div id="modal-login" class="modal">
  <div class="modal-content">
    <span id="modal-close" class="close">&times;</span>
    <h2 id="modal-title">Login</h2>

    <form id="auth-form">
      <label for="username">User:</label>
      <input type="text" id="username" name="username" placeholder="User" required />

      <label for="password">Password:</label>
      <input type="password" id="password" name="password" placeholder="Password" required />

      <!-- Campo extra solo para registro -->
      <div id="email-container" style="display:none;">
        <label for="email">email:</label>
        <input type="email" id="email" name="email" placeholder="Email" />
      </div>

      <button type="submit" id="auth-submit">Login</button>
    </form>

    <!-- Mensajes de error o éxito -->
    <p id="auth-message" style="margin-top:10px; font-weight:bold;"></p>

    <!-- Toggle entre login/registro -->
    <p id="toggle-text">
      Don't have an account? <a href="#" id="toggle-auth">Register</a>
    </p>
  </div>
</div>

<script src="../estilo.js"></script>

<div class="logo-container">
  <img src="/img/mira.png" class="side-img flipped"/>
  
  <div class="logo">
     <img src="img/LETRAS HOENN.png" alt="HOENN TCG STORE" class="logo-text"/>
    
    <img src="/img/logo.png" class="side-img"  />
  </div>

  <img src="/img/kora.png" class="logo-icon"  />
</div>
<div id="product-list" class="product-list">
      <!-- Aquí cargarán los productos Boosters -->
    </div>

<div class="banner_inferior">
    <h2>Follow us</h2>
    <div class="social_icons">
        <a href="#"><img src="/img/svg/instagram-1-svgrepo-com.svg"/></a>
        <a href="#"><img src="/img/svg/whatsapp-svgrepo-com.svg"/></a>
        <a href="#"><img src="/img/svg/facebook-1-svgrepo-com.svg"/></a>
    </div>


<div class="imagen banner ">
    <img src="" alt="">
</div>

 <script>
    function renderProducts(products) {
      const container = document.getElementById('product-list');
      container.innerHTML = '';

      if (!products || products.length === 0) {
        container.innerHTML = '<p>No hay productos en esta categoría.</p>';
        return;
      }

      products.forEach((product) => {
        const card = document.createElement('div');
        card.classList.add('product-card');
        card.innerHTML = `
          <div class="product-image">
            <img src="${product.image_url || '/img/default-product.png'}" alt="${product.name}" />
          </div>
          <div class="product-info">
            <h3>${product.name}</h3>
            <p>${product.description}</p>
            <p class="price">$${product.price.toFixed(2)}</p>
            <button class="add-to-cart">Add to cart</button>
          </div>
        `;
        container.appendChild(card);
      });
    }

    window.addEventListener('DOMContentLoaded', () => {
      fetch('http://localhost:8081/api/products/category/booster')
        .then((res) => {
          if (!res.ok) throw new Error('Error al obtener productos Boosters');
          return res.json();
        })
        .then((products) => renderProducts(products))
        .catch(() => {
          document.getElementById('product-list').innerHTML =
            '<p>Error al cargar productos.</p>';
        });
    });
  </script>

  <script>// ====== Carrito ======
const userId = localStorage.getItem('userId'); // Asegúrate de guardar userId al hacer login

async function loadCart() {
  if (!userId) return; // Si no hay usuario logueado, no hacemos nada
  try {
    const res = await fetch(`http://localhost:8081/api/cart/${userId}`);
    const items = await res.json();
    renderCart(items);
  } catch (err) {
    console.error('Error al cargar carrito:', err);
  }
}

function renderCart(items) {
  const container = document.getElementById('cart-container');
  if (!container) return;
  container.innerHTML = '';

  if (!items || items.length === 0) {
    container.innerHTML = '<p>The cart is empty.</p>';
    return;
  }

  items.forEach(item => {
    const div = document.createElement('div');
    div.className = 'cart-item';
    div.innerHTML = `
      <p>${item.product.name} x ${item.quantity} - $${(item.product.price * item.quantity).toFixed(2)}</p>
      <button onclick="removeFromCart(${item.product.id})">Eliminar</button>
    `;
    container.appendChild(div);
  });
}

async function addToCart(productId, quantity = 1) {
  if (!userId) return alert('Inicia sesión primero.');
  try {
    await fetch(`http://localhost:8081/api/cart/add?userId=${userId}&productId=${productId}&quantity=${quantity}`, { method: 'POST' });
    loadCart();
  } catch (err) {
    console.error('Error al agregar al carrito:', err);
  }
}

async function removeFromCart(productId) {
  if (!userId) return;
  try {
    await fetch(`http://localhost:8081/api/cart/remove?userId=${userId}&productId=${productId}`, { method: 'DELETE' });
    loadCart();
  } catch (err) {
    console.error('Error al eliminar del carrito:', err);
  }
}

// Carga el carrito al iniciar
window.addEventListener('DOMContentLoaded', loadCart);

</script>
</body>
</html>
